<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tool.title }} - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Ÿè¡Œ - Pythonã§ã§ãã‚‹ãƒ“ã‚¸ãƒã‚¹è‡ªå‹•åŒ–</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .step-box { background: white; padding: 20px; border-radius: 10px; margin: 15px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .CodeMirror { height: 300px; border: 1px solid #ddd; border-radius: 5px; }
        .result-box { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; }
        .loading { display: none; }
        .btn-execute { margin-top: 10px; }
        
        /* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .upload-zone { 
            border: 2px dashed #dee2e6; 
            border-radius: 10px; 
            padding: 30px; 
            text-align: center; 
            background: #f8f9fa; 
            transition: all 0.3s ease; 
        }
        .upload-zone.dragover { 
            border-color: #007bff; 
            background: #e3f2fd; 
        }
        .uploaded-file { 
            background: white; 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 10px; 
            margin: 5px 0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .file-info { 
            display: flex; 
            align-items: center; 
        }
        .file-icon { 
            margin-right: 10px; 
            font-size: 1.2rem; 
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®ã‚¿ãƒƒãƒæœ€é©åŒ– */
        @media (max-width: 768px) {
            /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®å¤§ããªãƒœã‚¿ãƒ³ */
            .btn {
                min-height: 60px;
                font-size: 1.1rem;
                padding: 15px 20px;
                border-radius: 12px;
                font-weight: 600;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                margin: 8px 4px;
            }
            
            .btn-lg {
                min-height: 70px;
                font-size: 1.3rem;
                padding: 20px 25px;
            }
            
            .btn-sm {
                min-height: 50px;
                font-size: 1rem;
                padding: 12px 16px;
            }
            
            /* ã‚¹ãƒ†ãƒƒãƒ—ãƒœãƒƒã‚¯ã‚¹ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
            .step-box {
                padding: 20px 15px;
                margin: 10px 0;
                border-radius: 15px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¿ãƒƒãƒæœ€é©åŒ– */
            .form-control, textarea {
                min-height: 50px;
                font-size: 1rem;
                padding: 15px;
                border-radius: 10px;
                border: 2px solid #dee2e6;
                transition: all 0.3s ease;
            }
            
            .form-control:focus, textarea:focus {
                border-color: #007bff;
                box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
                transform: scale(1.02);
            }
            
            textarea {
                min-height: 120px;
                resize: vertical;
            }
            
            /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¾ãƒ¼ãƒ³ã®ã‚¿ãƒƒãƒæœ€é©åŒ– */
            .upload-zone {
                padding: 40px 20px;
                border-radius: 15px;
                border-width: 3px;
                min-height: 150px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .upload-zone:hover, .upload-zone.dragover {
                transform: scale(1.02);
                border-color: #007bff;
                background: #e3f2fd;
            }
            
            /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ãƒƒãƒæœ€é©åŒ– */
            .uploaded-file {
                padding: 15px;
                border-radius: 10px;
                margin: 10px 0;
                min-height: 60px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
            }
            
            .uploaded-file:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }
            
            /* ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ– */
            .CodeMirror {
                height: 250px;
                border-radius: 10px;
                border: 2px solid #dee2e6;
                font-size: 0.9rem;
            }
            
            /* çµæœãƒœãƒƒã‚¯ã‚¹ã®æœ€é©åŒ– */
            .result-box {
                padding: 20px;
                border-radius: 10px;
                font-size: 0.9rem;
                line-height: 1.5;
                max-height: 300px;
                overflow-y: auto;
            }
            
            /* ã‚¢ãƒ©ãƒ¼ãƒˆã®æœ€é©åŒ– */
            .alert {
                padding: 15px 20px;
                border-radius: 10px;
                font-size: 0.95rem;
                margin-bottom: 15px;
            }
            
            /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒœã‚¿ãƒ³ã®æœ€é©åŒ– */
            .accordion-button {
                min-height: 60px;
                font-size: 1.05rem;
                padding: 15px 20px;
                border-radius: 10px !important;
            }
            
            /* ã‚¿ã‚¤ãƒˆãƒ«ã®èª¿æ•´ */
            h1 {
                font-size: 1.6rem;
                line-height: 1.3;
                margin-bottom: 1rem;
            }
            
            h2 {
                font-size: 1.3rem;
                line-height: 1.4;
            }
            
            h3 {
                font-size: 1.15rem;
                line-height: 1.4;
                margin-bottom: 1rem;
            }
            
            /* ã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ */
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ */
            .col-md-6 {
                margin-bottom: 1rem;
            }
            
            /* ãƒãƒƒã‚¸ã®æœ€é©åŒ– */
            .badge {
                font-size: 0.8rem;
                padding: 8px 14px;
                border-radius: 20px;
                margin: 2px;
            }
        }
        
        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ã®èª¿æ•´ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .btn {
                min-height: 55px;
                font-size: 1.05rem;
                padding: 12px 18px;
            }
            
            .form-control, textarea {
                min-height: 45px;
                font-size: 0.95rem;
            }
        }
        
        /* ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã®ã‚¿ãƒƒãƒæ”¹å–„ */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š */
        .btn:focus, .form-control:focus {
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
            outline: none;
        }
        
        /* ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
        html {
            scroll-behavior: smooth;
        }
        
        /* ã‚¿ãƒƒãƒãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
        .btn, .card, .upload-zone, .uploaded-file {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®æ”¹å–„ */
        .btn:disabled {
            opacity: 0.7;
            transform: scale(0.98);
        }
        
        .loading {
            margin-right: 8px;
        }
        
        /* éŸ³å£°å…¥åŠ›æ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .voice-btn {
            min-width: 60px;
            font-size: 1.2rem;
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .voice-btn.recording {
            background: #dc3545;
            color: white;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .voice-indicator {
            animation: voice-wave 0.8s infinite;
        }
        
        @keyframes voice-wave {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .input-group textarea {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        /* ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .camera-preview {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .camera-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .document-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <a href="/" class="btn btn-outline-secondary mb-4">â† ä¸€è¦§ã«æˆ»ã‚‹</a>
            
            <div class="mb-3 d-flex align-items-center">
                <span class="badge bg-secondary me-2">{{ tool.category }}</span>
                <span class="badge bg-primary">{{ tool.id }}</span>
            </div>
            <h1 class="mb-4">ğŸ¤– {{ tool.title }} - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Ÿè¡Œ</h1>
            <p class="lead">{{ tool.desc }}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
            <div class="step-box mb-4">
                <h3>ğŸ§‘â€ğŸ’» ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
                <ol class="mb-2">
                    <li>ã€ŒAIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¾ã™ï¼ˆè‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸå†…å®¹ã‚’ãã®ã¾ã¾ä½¿ã£ã¦ã‚‚OKï¼‰ã€‚</li>
                    <li>å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆCSVã‚„ç”»åƒãªã©ï¼‰ã€‚</li>
                    <li>è¨­å®šæ¬„ã«APIã‚­ãƒ¼ã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
                    <li>ã€ŒAIã«ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ä¾é ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€Pythonã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</li>
                    <li>ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€ã€Œã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã§å®Ÿè¡Œã—ã¾ã™ã€‚</li>
                    <li>å®Ÿè¡Œçµæœã‚„ã‚°ãƒ©ãƒ•ãŒå³å´ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
                </ol>
                <div class="alert alert-info mb-0">
                    <strong>ãƒ’ãƒ³ãƒˆï¼š</strong> ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦å‹•ä½œç¢ºèªã§ãã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã¯ä¸‹éƒ¨ã®ã€Œã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰ã€ã‚‚ã”è¦§ãã ã•ã„ã€‚
                </div>
                <div class="alert alert-warning mt-2 mb-0">
                    <strong>âš ï¸ é‡è¦ï¼š</strong> Webå®Ÿè¡Œç’°å¢ƒã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãŒå¿…è¦ãªå ´åˆã¯é–‹ç™ºç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—1: AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ› -->
            <div class="step-box mb-4">
                <h3>ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—1: AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç¢ºèªãƒ»ç·¨é›†</h3>
                <div class="mt-3">
                    <div class="alert alert-info">
                        <strong>è‡ªå‹•ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</strong>
                        <p class="mb-2">ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè‡ªå‹•ã§ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å¿…è¦ã«å¿œã˜ã¦ç·¨é›†ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                    
                    <div class="input-group">
                        <textarea id="promptInput" class="form-control" rows="8" placeholder="AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">{{ tool.ai_prompt or '' }}</textarea>
                        <div class="input-group-append">
                            <button id="voiceBtn" class="btn btn-outline-secondary voice-btn" type="button" title="éŸ³å£°å…¥åŠ›">
                                ğŸ¤
                            </button>
                        </div>
                    </div>
                    
                    <div id="voiceStatus" class="mt-2 text-center" style="display: none;">
                        <div class="alert alert-info">
                            <span class="voice-indicator">ğŸ™ï¸</span>
                            <span id="voiceText">éŸ³å£°ã‚’èªè­˜ä¸­...</span>
                            <button id="stopVoiceBtn" class="btn btn-sm btn-outline-danger ms-2">åœæ­¢</button>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button id="generateBtn" class="btn btn-primary btn-execute">
                            <span class="spinner-border spinner-border-sm loading" role="status"></span>
                            ğŸ¤– AIã«ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ä¾é ¼
                        </button>
                        <button id="clearBtn" class="btn btn-outline-secondary btn-execute">
                            ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                        </button>
                    </div>
                </div>
            </div>

            <!-- ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰ -->
            <div class="mt-4">
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faqHeading1">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1" aria-expanded="false" aria-controls="faqCollapse1">
                                â“ ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰
                            </button>
                        </h2>
                        <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>ğŸ”§ è¨­å®šé–¢é€£</h6>
                                        <ul class="small">
                                            <li><strong>APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼</strong>: æ­£ã—ã„APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</li>
                                            <li><strong>ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„</strong>: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</li>
                                            <li><strong>ãƒ¡ãƒ¢ãƒªä¸è¶³</strong>: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã¯åˆ†å‰²ã—ã¦å‡¦ç†ã—ã¦ãã ã•ã„</li>
                                        </ul>
                            </div>
                                    <div class="col-md-6">
                                        <h6>ğŸ’» å®Ÿè¡Œç’°å¢ƒ</h6>
                                        <ul class="small">
                                            <li><strong>ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚¨ãƒ©ãƒ¼</strong>: Webå®Ÿè¡Œã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™</li>
                                            <li><strong>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¶³</strong>: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li>
                                            <li><strong>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</strong>: é•·æ™‚é–“ã®å‡¦ç†ã¯é–‹ç™ºç’°å¢ƒã§å®Ÿè¡Œã—ã¦ãã ã•ã„</li>
                                        </ul>
                        </div>
                    </div>
                                
                                <div class="mt-3">
                                    <h6>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã«ã¤ã„ã¦</h6>
                                    <div class="alert alert-warning">
                                        <strong>Webå®Ÿè¡Œç’°å¢ƒã®åˆ¶é™:</strong><br>
                                        â€¢ ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãè¾¼ã¿ãƒ»ä¿å­˜ã¯ã§ãã¾ã›ã‚“<br>
                                        â€¢ ã‚°ãƒ©ãƒ•ã‚„CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã¯åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™<br>
                                        â€¢ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆãƒ»æ›´æ–°ã¯ã§ãã¾ã›ã‚“<br><br>
                                        <strong>è§£æ±ºç­–:</strong><br>
                                        â€¢ é–‹ç™ºç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„<br>
                                        â€¢ çµæœã¯ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã¯ã§ãã¾ã›ã‚“ï¼‰<br>
                                        â€¢ å¿…è¦ãªå ´åˆã¯ã€è¡¨ç¤ºã•ã‚ŒãŸçµæœã‚’æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„
                        </div>
                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚«ãƒ¡ãƒ©æ’®å½± -->
            <div class="step-box">
                <h3>ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚«ãƒ¡ãƒ©ã§æ’®å½±ï¼ˆå¿…è¦ãªå ´åˆï¼‰</h3>
                <div class="mt-3">
                    <div class="alert alert-info">
                        <strong>ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ãªå ´åˆï¼š</strong>
                        <p class="mb-2">ã“ã®è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã§ä½¿ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCSVã€Excelã€ç”»åƒãªã©ï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã¾ãŸã¯ã‚«ãƒ¡ãƒ©ã§æ–‡æ›¸ã‚’æ’®å½±ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                    
                    <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹æ³•é¸æŠ -->
                    <div class="mb-3">
                        <div class="btn-group w-100" role="group">
                            <button type="button" class="btn btn-outline-primary active" id="uploadModeBtn">
                                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="cameraModeBtn">
                                ğŸ“· ã‚«ãƒ¡ãƒ©æ’®å½±
                            </button>
                        </div>
                    </div>
                    
                    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ -->
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-zone" id="uploadZone">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #6c757d;"></i>
                            <p class="mt-2">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
                            <input type="file" id="fileInput" multiple accept=".csv,.xlsx,.xls,.txt,.json,.jpg,.jpeg,.png,.gif,.pdf" style="display: none;">
                            <button class="btn btn-outline-primary mt-2" onclick="document.getElementById('fileInput').click()">
                                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ã‚«ãƒ¡ãƒ©æ’®å½±ãƒ¢ãƒ¼ãƒ‰ -->
                    <div class="camera-area" id="cameraArea" style="display: none;">
                        <div class="text-center">
                            <video id="cameraPreview" class="camera-preview" style="display: none;" autoplay></video>
                            <canvas id="captureCanvas" style="display: none;"></canvas>
                            <div id="capturedImage" class="mt-3" style="display: none;">
                                <img id="documentPreview" class="document-preview" alt="æ’®å½±ã•ã‚ŒãŸæ–‡æ›¸">
                            </div>
                            
                            <div class="camera-controls">
                                <button id="startCameraBtn" class="btn btn-success">
                                    ğŸ“· ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹
                                </button>
                                <button id="captureBtn" class="btn btn-primary" style="display: none;">
                                    ğŸ“¸ æ’®å½±
                                </button>
                                <button id="retakeBtn" class="btn btn-warning" style="display: none;">
                                    ğŸ”„ å†æ’®å½±
                                </button>
                                <button id="stopCameraBtn" class="btn btn-secondary" style="display: none;">
                                    â¹ï¸ ã‚«ãƒ¡ãƒ©åœæ­¢
                                </button>
                                <button id="usePhotoBtn" class="btn btn-success" style="display: none;">
                                    âœ… ã“ã®å†™çœŸã‚’ä½¿ç”¨
                                </button>
                            </div>
                            
                            <div class="mt-3">
                                <small class="text-muted">
                                    ğŸ’¡ ãƒ’ãƒ³ãƒˆ: æ–‡æ›¸å…¨ä½“ãŒç”»é¢ã«åã¾ã‚‹ã‚ˆã†ã«æ’®å½±ã—ã€æ˜ã‚‹ã„å ´æ‰€ã§æ’®å½±ã—ã¦ãã ã•ã„
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div id="uploadedFiles" class="mt-3">
                        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ -->
                    </div>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šå…¥åŠ› -->
            <div class="step-box">
                <h3>âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šã‚’å…¥åŠ›</h3>
                <div class="mt-3">
                    <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ -->
                    <div class="mb-4">
                        <div class="alert alert-success">
                            <strong>ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼š</strong>
                            <p class="mb-2">ã‚ˆãä½¿ã†è¨­å®šã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰é¸æŠã§ãã¾ã™</p>
                        </div>
                        
                        <div class="mb-3">
                            <label for="presetSelect" class="form-label">ğŸ“‹ ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®š</label>
                            <select id="presetSelect" class="form-control">
                                <option value="">ã‚«ã‚¹ã‚¿ãƒ è¨­å®š</option>
                                <option value="email-basic">ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆåŸºæœ¬ï¼‰</option>
                                <option value="excel-analysis">ğŸ“Š Excelåˆ†æï¼ˆå£²ä¸Šé›†è¨ˆï¼‰</option>
                                <option value="file-organizer">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰</option>
                                <option value="report-generator">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆæœˆæ¬¡ï¼‰</option>
                                <option value="data-scraping">ğŸ•·ï¸ ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆECä¾¡æ ¼ï¼‰</option>
                            </select>
                        </div>
                        
                        <div class="text-center">
                            <button id="loadPresetBtn" class="btn btn-info" disabled>
                                âš¡ ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿
                            </button>
                            <button id="savePresetBtn" class="btn btn-outline-success">
                                ğŸ’¾ ç¾åœ¨ã®è¨­å®šã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <strong>æ³¨æ„ï¼š</strong>
                        <p class="mb-2">å®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯ã€ä»¥ä¸‹ã®è¨­å®šã‚’è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                    
                    <div id="configForm">
                        <!-- å‹•çš„ã«è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                    
                    <!-- å®‰å…¨ãªå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="mt-4">
                        <div class="alert alert-info">
                            <strong>ğŸ”’ å®‰å…¨ãªå…¥åŠ›ã«ã¤ã„ã¦</strong>
                            <ul class="mb-0 mt-2">
                                <li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„APIã‚­ãƒ¼ã¯æš—å·åŒ–ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™</li>
                                <li>å…¥åŠ›ã—ãŸæƒ…å ±ã¯ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™</li>
                                <li>ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹ã¨æƒ…å ±ã¯è‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã¾ã™</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <label for="apiKey">ğŸ”‘ APIã‚­ãƒ¼ï¼ˆå¿…è¦ãªå ´åˆï¼‰</label>
                            <input type="password" class="form-control" id="apiKey" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›">
                            <small class="form-text text-muted">Twitterã€Slackã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã©ã§ä½¿ç”¨</small>
                        </div>
                        
                        <div class="form-group mt-3">
                            <label for="email">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆé€šçŸ¥ç”¨ï¼‰</label>
                            <input type="email" class="form-control" id="email" placeholder="example@company.com">
                            <small class="form-text text-muted">å®Ÿè¡Œçµæœã®é€šçŸ¥ã‚’å—ã‘å–ã‚‹å ´åˆ</small>
                        </div>
                        
                        <div class="form-group mt-3">
                            <label for="customSettings">âš™ï¸ ã‚«ã‚¹ã‚¿ãƒ è¨­å®šï¼ˆJSONå½¢å¼ï¼‰</label>
                            <textarea class="form-control" id="customSettings" rows="3" placeholder='{"interval": "daily", "time": "09:00"}'></textarea>
                            <small class="form-text text-muted">ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®è¨­å®šã‚’JSONå½¢å¼ã§å…¥åŠ›</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button id="saveConfigBtn" class="btn btn-success">
                            ğŸ’¾ è¨­å®šã‚’ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <!-- ã‚¹ãƒ†ãƒƒãƒ—4: ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ»å®Ÿè¡Œ -->
            <div class="step-box">
                <h3>ğŸ’» ã‚¹ãƒ†ãƒƒãƒ—4: ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰</h3>
                <div class="mt-3">
                    <div id="codeContainer">
                        <div class="alert alert-secondary">
                            <strong>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå¾…ã¡ï¼š</strong>
                            <p class="mb-0">å·¦å´ã®ã€ŒAIã«ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ä¾é ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button id="executeBtn" class="btn btn-success btn-execute" disabled>
                            <span class="spinner-border spinner-border-sm loading" role="status"></span>
                            â–¶ï¸ ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ
                        </button>
                        <button id="downloadBtn" class="btn btn-outline-primary btn-execute" disabled>
                            ğŸ“¥ ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—5: å®Ÿè¡Œçµæœ -->
            <div class="step-box">
                <h3>ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—5: å®Ÿè¡Œçµæœ</h3>
                <div class="mt-3">
                    <div id="resultContainer">
                        <div class="alert alert-info">
                            <strong>å®Ÿè¡Œçµæœï¼š</strong>
                            <p class="mb-0">ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
<script>
let codeEditor = null;
let generatedCode = '';

// è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆ
function generateConfigFields() {
    const configForm = document.getElementById('configForm');
    const toolId = {{ tool.id }};
    
    // ãƒ„ãƒ¼ãƒ«åˆ¥ã®è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    const configs = {
        1: [ // ãƒ¡ãƒ¼ãƒ«è‡ªå‹•é€ä¿¡
            { name: 'sender_email', label: 'é€ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type: 'email', placeholder: 'your_email@gmail.com' },
            { name: 'receiver_email', label: 'å—ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type: 'email', placeholder: 'receiver@example.com' },
            { name: 'subject', label: 'ä»¶å', type: 'text', placeholder: 'è‡ªå‹•é€ä¿¡ãƒ¡ãƒ¼ãƒ«' },
            { name: 'message', label: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', type: 'textarea', placeholder: 'ã“ã‚Œã¯è‡ªå‹•é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã§ã™ã€‚' }
        ],
        2: [ // Excelè‡ªå‹•å‡¦ç†
            { name: 'input_file', label: 'å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«å', type: 'text', placeholder: 'data.xlsx' },
            { name: 'output_file', label: 'å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å', type: 'text', placeholder: 'result.xlsx' },
            { name: 'target_column', label: 'é›†è¨ˆå¯¾è±¡åˆ—', type: 'text', placeholder: 'å£²ä¸Š' }
        ],
        6: [ // ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•æ•´ç†
            { name: 'folder_path', label: 'æ•´ç†å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€', type: 'text', placeholder: 'C:/Users/YourName/Downloads' }
        ]
    };
    
    const fields = configs[toolId] || [
        { name: 'custom_setting', label: 'ã‚«ã‚¹ã‚¿ãƒ è¨­å®š', type: 'text', placeholder: 'è¨­å®šå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' }
    ];
    
    configForm.innerHTML = fields.map(field => `
        <div class="mb-3">
            <label for="${field.name}" class="form-label">${field.label}</label>
            ${field.type === 'textarea' 
                ? `<textarea id="${field.name}" class="form-control" placeholder="${field.placeholder}"></textarea>`
                : `<input type="${field.type}" id="${field.name}" class="form-control" placeholder="${field.placeholder}">`
            }
        </div>
    `).join('');
}

// ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
document.getElementById('generateBtn').addEventListener('click', async function() {
    const btn = this;
    const prompt = document.getElementById('promptInput').value;
    
    if (!prompt.trim()) {
        alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
    }
    
    btn.disabled = true;
    btn.querySelector('.loading').style.display = 'inline-block';
    
    try {
        const response = await fetch('/api/generate-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tool_id: {{ tool.id }},
                custom_prompt: prompt
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            generatedCode = data.code;
            
            // CodeMirrorã‚¨ãƒ‡ã‚£ã‚¿ã‚’åˆæœŸåŒ–
            if (codeEditor) {
                codeEditor.setValue(generatedCode);
            } else {
                const textarea = document.createElement('textarea');
                textarea.id = 'codeEditor';
                document.getElementById('codeContainer').innerHTML = '';
                document.getElementById('codeContainer').appendChild(textarea);
                
                codeEditor = CodeMirror.fromTextArea(textarea, {
                    mode: 'python',
                    theme: 'monokai',
                    lineNumbers: true,
                    readOnly: false
                });
                codeEditor.setValue(generatedCode);
            }
            
            document.getElementById('executeBtn').disabled = false;
            document.getElementById('downloadBtn').disabled = false;
            
        } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
        }
        
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    } finally {
        btn.disabled = false;
        btn.querySelector('.loading').style.display = 'none';
    }
});

// ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
document.getElementById('executeBtn').addEventListener('click', async function() {
    const btn = this;
    const code = codeEditor ? codeEditor.getValue() : generatedCode;
    
    if (!code.trim()) {
        alert('å®Ÿè¡Œã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    btn.disabled = true;
    btn.querySelector('.loading').style.display = 'inline-block';
    
    try {
        const response = await fetch('/api/execute-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tool_id: {{ tool.id }},
                code: code
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            let resultHtml = '';
            
            // ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã¯å¤±æ•—ã¨ã—ã¦æ‰±ã†
            if (data.stderr && data.stderr.trim()) {
                resultHtml = '<div class="alert alert-danger"><strong>âŒ å®Ÿè¡Œã‚¨ãƒ©ãƒ¼</strong></div>';
                resultHtml += `<div class="result-box text-danger"><strong>ã‚¨ãƒ©ãƒ¼:</strong><br>${data.stderr.replace(/\n/g, '<br>')}</div>`;
            } else {
                resultHtml = '<div class="alert alert-success"><strong>âœ… å®Ÿè¡ŒæˆåŠŸï¼</strong></div>';
            }
            
            if (data.stdout) {
                resultHtml += `<div class="result-box"><strong>å‡ºåŠ›:</strong><br>${data.stdout.replace(/\n/g, '<br>')}</div>`;
            }
            
            document.getElementById('resultContainer').innerHTML = resultHtml;
            
        } else {
            let errorMessage = data.error;
            let errorType = 'danger';
            let errorIcon = 'âŒ';
            
            if (data.error.includes('Security:')) {
                errorMessage = 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯Webå®Ÿè¡Œç’°å¢ƒã§ã¯å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚';
                errorType = 'warning';
                errorIcon = 'ğŸ”’';
            } else if (data.error.includes('timed out')) {
                errorMessage = 'ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡ŒãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚„é•·æ™‚é–“ã®å‡¦ç†ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
                errorType = 'warning';
                errorIcon = 'â°';
            } else if (data.error.includes('FileNotFoundError')) {
                errorMessage = 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚';
                errorType = 'info';
                errorIcon = 'ğŸ“';
            } else if (data.error.includes('ImportError')) {
                errorMessage = 'å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
                errorType = 'warning';
                errorIcon = 'ğŸ“¦';
            } else if (data.error.includes('PermissionError')) {
                errorMessage = 'æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
                errorType = 'danger';
                errorIcon = 'ğŸš«';
            }
            
            document.getElementById('resultContainer').innerHTML = 
                `<div class="alert alert-${errorType}">
                    <strong>${errorIcon} å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:</strong><br>
                    ${errorMessage}
                    <div class="mt-2">
                        <small class="text-muted">
                            ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã¯ã€Œã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•ã€ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                        </small>
                    </div>
                </div>`;
        }
        
    } catch (error) {
        document.getElementById('resultContainer').innerHTML = 
            `<div class="alert alert-danger"><strong>âŒ ã‚¨ãƒ©ãƒ¼:</strong><br>${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.querySelector('.loading').style.display = 'none';
    }
});

// ã‚³ãƒ¼ãƒ‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
document.getElementById('downloadBtn').addEventListener('click', function() {
    const code = codeEditor ? codeEditor.getValue() : generatedCode;
    
    if (!code.trim()) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    const blob = new Blob([code], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '{{ tool.title }}_code.py';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});

// è¨­å®šä¿å­˜
document.getElementById('saveConfigBtn').addEventListener('click', async function() {
    const configData = {};
    const configForm = document.getElementById('configForm');
    const inputs = configForm.querySelectorAll('input, textarea');
    
    inputs.forEach(input => {
        configData[input.id] = input.value;
    });
    
    try {
        const response = await fetch('/api/save-config', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tool_id: {{ tool.id }},
                config: configData
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
        }
        
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
});

// ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
let uploadedFiles = [];

// ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');

uploadZone.addEventListener('dragover', function(e) {
    e.preventDefault();
    uploadZone.classList.add('dragover');
});

uploadZone.addEventListener('dragleave', function(e) {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
});

uploadZone.addEventListener('drop', function(e) {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    handleFiles(files);
});

fileInput.addEventListener('change', function(e) {
    handleFiles(e.target.files);
});

function handleFiles(files) {
    Array.from(files).forEach(file => {
        uploadFile(file);
    });
}

async function uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    try {
        const response = await fetch('/api/upload-file', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            uploadedFiles.push({
                id: data.file_id,
                filename: data.filename
            });
            updateUploadedFilesList();
            showAlert('success', data.message);
        } else {
            showAlert('danger', data.error);
        }
    } catch (error) {
        showAlert('danger', 'ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

function updateUploadedFilesList() {
    const container = document.getElementById('uploadedFiles');
    
    if (uploadedFiles.length === 0) {
        container.innerHTML = '<p class="text-muted">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        return;
    }
    
    container.innerHTML = uploadedFiles.map(file => `
        <div class="uploaded-file">
            <div class="file-info">
                <span class="file-icon">ğŸ“</span>
                <span>${file.filename}</span>
            </div>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('${file.id}')">
                ğŸ—‘ï¸ å‰Šé™¤
            </button>
        </div>
    `).join('');
}

async function deleteFile(fileId) {
    try {
        const response = await fetch(`/api/delete-file/${fileId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            uploadedFiles = uploadedFiles.filter(file => file.id !== fileId);
            updateUploadedFilesList();
            showAlert('success', data.message);
        } else {
            showAlert('danger', data.error);
        }
    } catch (error) {
        showAlert('danger', 'ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
    
    // 3ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆã™
    setTimeout(() => {
        alertDiv.remove();
    }, 3000);
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    generateConfigFields();
    updateUploadedFilesList();
    initializeVoiceInput();
    initializeCameraFeature();
    initializePresets();
    initializePWA();
});

// éŸ³å£°å…¥åŠ›æ©Ÿèƒ½
let recognition = null;
let isRecording = false;

function initializeVoiceInput() {
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        document.getElementById('voiceBtn').style.display = 'none';
        return;
    }
    
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    
    recognition.lang = 'ja-JP';
    recognition.continuous = true;
    recognition.interimResults = true;
    
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceStatus = document.getElementById('voiceStatus');
    const voiceText = document.getElementById('voiceText');
    const stopVoiceBtn = document.getElementById('stopVoiceBtn');
    const promptInput = document.getElementById('promptInput');
    
    voiceBtn.addEventListener('click', startVoiceInput);
    stopVoiceBtn.addEventListener('click', stopVoiceInput);
    
    recognition.onstart = () => {
        isRecording = true;
        voiceBtn.classList.add('recording');
        voiceStatus.style.display = 'block';
        voiceText.textContent = 'éŸ³å£°ã‚’èªè­˜ä¸­...';
    };
    
    recognition.onresult = (event) => {
        let finalTranscript = '';
        let interimTranscript = '';
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
                finalTranscript += transcript;
            } else {
                interimTranscript += transcript;
            }
        }
        
        if (finalTranscript) {
            const currentText = promptInput.value;
            promptInput.value = currentText + (currentText ? ' ' : '') + finalTranscript;
        }
        
        voiceText.textContent = interimTranscript || 'éŸ³å£°ã‚’èªè­˜ä¸­...';
    };
    
    recognition.onerror = (event) => {
        console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
        voiceText.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + event.error;
        setTimeout(stopVoiceInput, 2000);
    };
    
    recognition.onend = () => {
        stopVoiceInput();
    };
}

function startVoiceInput() {
    if (recognition && !isRecording) {
        recognition.start();
    }
}

function stopVoiceInput() {
    if (recognition && isRecording) {
        recognition.stop();
        isRecording = false;
        document.getElementById('voiceBtn').classList.remove('recording');
        document.getElementById('voiceStatus').style.display = 'none';
    }
}

// ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½
let currentStream = null;

function initializeCameraFeature() {
    const uploadModeBtn = document.getElementById('uploadModeBtn');
    const cameraModeBtn = document.getElementById('cameraModeBtn');
    const uploadArea = document.getElementById('uploadArea');
    const cameraArea = document.getElementById('cameraArea');
    const startCameraBtn = document.getElementById('startCameraBtn');
    const captureBtn = document.getElementById('captureBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const stopCameraBtn = document.getElementById('stopCameraBtn');
    const usePhotoBtn = document.getElementById('usePhotoBtn');
    const cameraPreview = document.getElementById('cameraPreview');
    const captureCanvas = document.getElementById('captureCanvas');
    const documentPreview = document.getElementById('documentPreview');
    const capturedImage = document.getElementById('capturedImage');
    
    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
    uploadModeBtn.addEventListener('click', () => {
        uploadModeBtn.classList.add('active');
        cameraModeBtn.classList.remove('active');
        uploadArea.style.display = 'block';
        cameraArea.style.display = 'none';
        stopCamera();
    });
    
    cameraModeBtn.addEventListener('click', () => {
        cameraModeBtn.classList.add('active');
        uploadModeBtn.classList.remove('active');
        uploadArea.style.display = 'none';
        cameraArea.style.display = 'block';
    });
    
    // ã‚«ãƒ¡ãƒ©åˆ¶å¾¡
    startCameraBtn.addEventListener('click', startCamera);
    captureBtn.addEventListener('click', capturePhoto);
    retakeBtn.addEventListener('click', retakePhoto);
    stopCameraBtn.addEventListener('click', stopCamera);
    usePhotoBtn.addEventListener('click', useCurrentPhoto);
}

async function startCamera() {
    try {
        const constraints = {
            video: {
                facingMode: 'environment', // èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’å„ªå…ˆ
                width: { ideal: 1920 },
                height: { ideal: 1080 }
            }
        };
        
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        const cameraPreview = document.getElementById('cameraPreview');
        const startCameraBtn = document.getElementById('startCameraBtn');
        const captureBtn = document.getElementById('captureBtn');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        
        cameraPreview.srcObject = currentStream;
        cameraPreview.style.display = 'block';
        startCameraBtn.style.display = 'none';
        captureBtn.style.display = 'inline-block';
        stopCameraBtn.style.display = 'inline-block';
        
    } catch (error) {
        console.error('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }
}

function capturePhoto() {
    const cameraPreview = document.getElementById('cameraPreview');
    const captureCanvas = document.getElementById('captureCanvas');
    const documentPreview = document.getElementById('documentPreview');
    const capturedImage = document.getElementById('capturedImage');
    const captureBtn = document.getElementById('captureBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const usePhotoBtn = document.getElementById('usePhotoBtn');
    
    const context = captureCanvas.getContext('2d');
    captureCanvas.width = cameraPreview.videoWidth;
    captureCanvas.height = cameraPreview.videoHeight;
    
    context.drawImage(cameraPreview, 0, 0);
    
    const imageDataUrl = captureCanvas.toDataURL('image/jpeg', 0.8);
    documentPreview.src = imageDataUrl;
    
    cameraPreview.style.display = 'none';
    capturedImage.style.display = 'block';
    captureBtn.style.display = 'none';
    retakeBtn.style.display = 'inline-block';
    usePhotoBtn.style.display = 'inline-block';
}

function retakePhoto() {
    const cameraPreview = document.getElementById('cameraPreview');
    const capturedImage = document.getElementById('capturedImage');
    const captureBtn = document.getElementById('captureBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const usePhotoBtn = document.getElementById('usePhotoBtn');
    
    cameraPreview.style.display = 'block';
    capturedImage.style.display = 'none';
    captureBtn.style.display = 'inline-block';
    retakeBtn.style.display = 'none';
    usePhotoBtn.style.display = 'none';
}

function stopCamera() {
    if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
        currentStream = null;
    }
    
    const cameraPreview = document.getElementById('cameraPreview');
    const capturedImage = document.getElementById('capturedImage');
    const startCameraBtn = document.getElementById('startCameraBtn');
    const captureBtn = document.getElementById('captureBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const stopCameraBtn = document.getElementById('stopCameraBtn');
    const usePhotoBtn = document.getElementById('usePhotoBtn');
    
    cameraPreview.style.display = 'none';
    capturedImage.style.display = 'none';
    startCameraBtn.style.display = 'inline-block';
    captureBtn.style.display = 'none';
    retakeBtn.style.display = 'none';
    stopCameraBtn.style.display = 'none';
    usePhotoBtn.style.display = 'none';
}

async function useCurrentPhoto() {
    const captureCanvas = document.getElementById('captureCanvas');
    
    try {
        // Canvas ã‚’ Blob ã«å¤‰æ›
        captureCanvas.toBlob(async (blob) => {
            const file = new File([blob], 'camera-capture.jpg', { type: 'image/jpeg' });
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
            const formData = new FormData();
            formData.append('file', file);
            
            const response = await fetch('/api/upload-file', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                uploadedFiles.push({
                    id: data.file_id,
                    filename: data.filename
                });
                updateUploadedFilesList();
                showAlert('success', 'ğŸ“· å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
                
                // ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
                document.getElementById('uploadModeBtn').click();
            } else {
                showAlert('danger', data.error);
            }
        }, 'image/jpeg', 0.8);
        
    } catch (error) {
        console.error('å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
        showAlert('danger', 'å†™çœŸã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

// ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
const presets = {
    'email-basic': {
        sender_email: 'your-email@gmail.com',
        receiver_email: 'recipient@example.com',
        subject: 'è‡ªå‹•é€ä¿¡ãƒ¡ãƒ¼ãƒ«',
        message: 'ã“ã‚Œã¯è‡ªå‹•ã§é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã§ã™ã€‚',
        apiKey: '',
        email: 'your-email@gmail.com'
    },
    'excel-analysis': {
        input_file: 'sales_data.xlsx',
        output_file: 'analysis_result.xlsx',
        target_column: 'å£²ä¸Š',
        apiKey: '',
        email: 'report@company.com'
    },
    'file-organizer': {
        folder_path: 'C:/Users/YourName/Downloads',
        apiKey: '',
        email: 'admin@company.com'
    },
    'report-generator': {
        report_type: 'æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',
        output_format: 'PDF',
        apiKey: '',
        email: 'manager@company.com'
    },
    'data-scraping': {
        target_url: 'https://example-shop.com',
        search_keyword: 'å•†å“å',
        apiKey: '',
        email: 'data@company.com'
    }
};

function initializePresets() {
    const presetSelect = document.getElementById('presetSelect');
    const loadPresetBtn = document.getElementById('loadPresetBtn');
    const savePresetBtn = document.getElementById('savePresetBtn');
    
    presetSelect.addEventListener('change', () => {
        loadPresetBtn.disabled = !presetSelect.value;
    });
    
    loadPresetBtn.addEventListener('click', loadPreset);
    savePresetBtn.addEventListener('click', savePreset);
}

function loadPreset() {
    const presetSelect = document.getElementById('presetSelect');
    const selectedPreset = presetSelect.value;
    
    if (!selectedPreset || !presets[selectedPreset]) {
        return;
    }
    
    const presetData = presets[selectedPreset];
    
    // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’è¨­å®š
    Object.entries(presetData).forEach(([key, value]) => {
        const field = document.getElementById(key);
        if (field) {
            field.value = value;
        }
    });
    
    showAlert('success', 'âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
}

function savePreset() {
    const presetName = prompt('ãƒ—ãƒªã‚»ãƒƒãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
    if (!presetName) return;
    
    const configData = {};
    const configForm = document.getElementById('configForm');
    const inputs = configForm.querySelectorAll('input, textarea, select');
    
    inputs.forEach(input => {
        configData[input.id] = input.value;
    });
    
    // åŸºæœ¬è¨­å®šã‚‚å«ã‚ã‚‹
    configData.apiKey = document.getElementById('apiKey').value;
    configData.email = document.getElementById('email').value;
    configData.customSettings = document.getElementById('customSettings').value;
    
    // LocalStorageã«ä¿å­˜
    const savedPresets = JSON.parse(localStorage.getItem('userPresets') || '{}');
    savedPresets[presetName] = configData;
    localStorage.setItem('userPresets', JSON.stringify(savedPresets));
    
    // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ 
    const presetSelect = document.getElementById('presetSelect');
    const option = document.createElement('option');
    option.value = presetName;
    option.textContent = `ğŸ’¾ ${presetName}ï¼ˆä¿å­˜æ¸ˆã¿ï¼‰`;
    presetSelect.appendChild(option);
    
    showAlert('success', `ğŸ’¾ ãƒ—ãƒªã‚»ãƒƒãƒˆã€Œ${presetName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);
}

// PWAæ©Ÿèƒ½
function initializePWA() {
    // Service Workerç™»éŒ²
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/static/sw.js')
                .then((registration) => {
                    console.log('SW registered: ', registration);
                })
                .catch((registrationError) => {
                    console.log('SW registration failed: ', registrationError);
                });
        });
    }
}

// ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³æ©Ÿèƒ½
document.getElementById('clearBtn').addEventListener('click', function() {
    if (confirm('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        document.getElementById('promptInput').value = '';
    }
});
</script>
</body>
</html> 