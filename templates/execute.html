<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tool.title }} - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Ÿè¡Œ - Pythonã§ã§ãã‚‹ãƒ“ã‚¸ãƒã‚¹è‡ªå‹•åŒ–</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .step-box { background: white; padding: 20px; border-radius: 10px; margin: 15px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .CodeMirror { height: 300px; border: 1px solid #ddd; border-radius: 5px; }
        .result-box { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; }
        .loading { display: none; }
        .btn-execute { margin-top: 10px; }
        
        /* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .upload-zone { 
            border: 2px dashed #dee2e6; 
            border-radius: 10px; 
            padding: 30px; 
            text-align: center; 
            background: #f8f9fa; 
            transition: all 0.3s ease; 
        }
        .upload-zone.dragover { 
            border-color: #007bff; 
            background: #e3f2fd; 
        }
        .uploaded-file { 
            background: white; 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 10px; 
            margin: 5px 0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .file-info { 
            display: flex; 
            align-items: center; 
        }
        .file-icon { 
            margin-right: 10px; 
            font-size: 1.2rem; 
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <a href="/" class="btn btn-outline-secondary mb-4">â† ä¸€è¦§ã«æˆ»ã‚‹</a>
            
            <div class="mb-3 d-flex align-items-center">
                <span class="badge bg-secondary me-2">{{ tool.category }}</span>
                <span class="badge bg-primary">{{ tool.id }}</span>
            </div>
            <h1 class="mb-4">ğŸ¤– {{ tool.title }} - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®Ÿè¡Œ</h1>
            <p class="lead">{{ tool.desc }}</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
            <div class="step-box mb-4">
                <h3>ğŸ§‘â€ğŸ’» ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
                <ol class="mb-2">
                    <li>å·¦å´ã®ã€ŒAIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¾ã™ï¼ˆè‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸå†…å®¹ã‚’ãã®ã¾ã¾ä½¿ã£ã¦ã‚‚OKï¼‰ã€‚</li>
                    <li>å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆCSVã‚„ç”»åƒãªã©ï¼‰ã€‚</li>
                    <li>è¨­å®šæ¬„ã«APIã‚­ãƒ¼ã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
                    <li>ã€ŒAIã«ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ä¾é ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€Pythonã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚</li>
                    <li>ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€ã€Œã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã§å®Ÿè¡Œã—ã¾ã™ã€‚</li>
                    <li>å®Ÿè¡Œçµæœã‚„ã‚°ãƒ©ãƒ•ãŒå³å´ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
                </ol>
                <div class="alert alert-info mb-0">
                    <strong>ãƒ’ãƒ³ãƒˆï¼š</strong> ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦å‹•ä½œç¢ºèªã§ãã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã¯ä¸‹éƒ¨ã®ã€Œã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•ã€ã‚‚ã”è¦§ãã ã•ã„ã€‚
                </div>
            </div>

            <!-- ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰ -->
            <div class="step-box mb-4">
                <h3>â“ ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰</h3>
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq1">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1">
                                Q. ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã©ã“ã«ä¿å­˜ã•ã‚Œã¾ã™ã‹ï¼Ÿ
                            </button>
                        </h2>
                        <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸€æ™‚çš„ã«ã‚µãƒ¼ãƒãƒ¼ä¸Šã«ä¿å­˜ã•ã‚Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™ã€‚å€‹äººæƒ…å ±ã‚„æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„ã§ãã ã•ã„ã€‚
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse2">
                                Q. APIã‚­ãƒ¼ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å®‰å…¨ã§ã™ã‹ï¼Ÿ
                            </button>
                        </h2>
                        <div id="faqCollapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                å…¥åŠ›ã—ãŸAPIã‚­ãƒ¼ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®ã¿åˆ©ç”¨ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã«ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚å®‰å…¨ã®ãŸã‚ã€ä¸è¦ã«ãªã£ãŸã‚‰ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq3">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse3">
                                Q. ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ
                            </button>
                        </h2>
                        <div id="faqCollapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                å®Ÿè¡Œçµæœã‚¨ãƒªã‚¢ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã€ä¸‹éƒ¨ã®ã€Œã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•ã€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚è§£æ±ºã—ãªã„å ´åˆã¯ç®¡ç†è€…ã«ã”ç›¸è«‡ãã ã•ã„ã€‚
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq4">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse4">
                                Q. ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã‹ï¼Ÿ
                            </button>
                        </h2>
                        <div id="faqCollapse4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                CSVã€Excelï¼ˆ.xlsx, .xlsï¼‰ã€ãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒï¼ˆjpg, png, gifï¼‰ã€PDFãªã©ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ã¯ç‰¹å®šã®å½¢å¼ã®ã¿å¯¾å¿œã®å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div class="step-box">
                <h3>ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆå¿…è¦ãªå ´åˆï¼‰</h3>
                <div class="mt-3">
                    <div class="alert alert-info">
                        <strong>ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ãªå ´åˆï¼š</strong>
                        <p class="mb-2">ã“ã®è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã§ä½¿ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCSVã€Excelã€ç”»åƒãªã©ï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                    
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-zone" id="uploadZone">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #6c757d;"></i>
                            <p class="mt-2">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
                            <input type="file" id="fileInput" multiple accept=".csv,.xlsx,.xls,.txt,.json,.jpg,.jpeg,.png,.gif,.pdf" style="display: none;">
                            <button class="btn btn-outline-primary mt-2" onclick="document.getElementById('fileInput').click()">
                                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                            </button>
                        </div>
                    </div>
                    
                    <div id="uploadedFiles" class="mt-3">
                        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ -->
                    </div>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šå…¥åŠ› -->
            <div class="step-box">
                <h3>âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šã‚’å…¥åŠ›</h3>
                <div class="mt-3">
                    <div class="alert alert-warning">
                        <strong>æ³¨æ„ï¼š</strong>
                        <p class="mb-2">å®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯ã€ä»¥ä¸‹ã®è¨­å®šã‚’è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>
                    </div>
                    
                    <div id="configForm">
                        <!-- å‹•çš„ã«è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                    
                    <!-- å®‰å…¨ãªå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="mt-4">
                        <div class="alert alert-info">
                            <strong>ğŸ”’ å®‰å…¨ãªå…¥åŠ›ã«ã¤ã„ã¦</strong>
                            <ul class="mb-0 mt-2">
                                <li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„APIã‚­ãƒ¼ã¯æš—å·åŒ–ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™</li>
                                <li>å…¥åŠ›ã—ãŸæƒ…å ±ã¯ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™</li>
                                <li>ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹ã¨æƒ…å ±ã¯è‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã¾ã™</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <label for="apiKey">ğŸ”‘ APIã‚­ãƒ¼ï¼ˆå¿…è¦ãªå ´åˆï¼‰</label>
                            <input type="password" class="form-control" id="apiKey" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›">
                            <small class="form-text text-muted">Twitterã€Slackã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã©ã§ä½¿ç”¨</small>
                        </div>
                        
                        <div class="form-group mt-3">
                            <label for="email">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆé€šçŸ¥ç”¨ï¼‰</label>
                            <input type="email" class="form-control" id="email" placeholder="example@company.com">
                            <small class="form-text text-muted">å®Ÿè¡Œçµæœã®é€šçŸ¥ã‚’å—ã‘å–ã‚‹å ´åˆ</small>
                        </div>
                        
                        <div class="form-group mt-3">
                            <label for="customSettings">âš™ï¸ ã‚«ã‚¹ã‚¿ãƒ è¨­å®šï¼ˆJSONå½¢å¼ï¼‰</label>
                            <textarea class="form-control" id="customSettings" rows="3" placeholder='{"interval": "daily", "time": "09:00"}'></textarea>
                            <small class="form-text text-muted">ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®è¨­å®šã‚’JSONå½¢å¼ã§å…¥åŠ›</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button id="saveConfigBtn" class="btn btn-success">
                            ğŸ’¾ è¨­å®šã‚’ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <!-- ã‚¹ãƒ†ãƒƒãƒ—4: ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ»å®Ÿè¡Œ -->
            <div class="step-box">
                <h3>ğŸ’» ã‚¹ãƒ†ãƒƒãƒ—4: ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰</h3>
                <div class="mt-3">
                    <div id="codeContainer">
                        <div class="alert alert-secondary">
                            <strong>ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå¾…ã¡ï¼š</strong>
                            <p class="mb-0">å·¦å´ã®ã€ŒAIã«ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ä¾é ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button id="executeBtn" class="btn btn-success btn-execute" disabled>
                            <span class="spinner-border spinner-border-sm loading" role="status"></span>
                            â–¶ï¸ ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ
                        </button>
                        <button id="downloadBtn" class="btn btn-outline-primary btn-execute" disabled>
                            ğŸ“¥ ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—5: å®Ÿè¡Œçµæœ -->
            <div class="step-box">
                <h3>ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—5: å®Ÿè¡Œçµæœ</h3>
                <div class="mt-3">
                    <div id="resultContainer">
                        <div class="alert alert-info">
                            <strong>å®Ÿè¡Œçµæœï¼š</strong>
                            <p class="mb-0">ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ -->
<div class="mt-4">
    <div class="accordion" id="errorGuide">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                    â“ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#errorGuide">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>ğŸ”§ è¨­å®šé–¢é€£</h6>
                            <ul class="small">
                                <li><strong>APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼</strong>: æ­£ã—ã„APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</li>
                                <li><strong>ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„</strong>: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</li>
                                <li><strong>æ¨©é™ã‚¨ãƒ©ãƒ¼</strong>: ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>ğŸ’» ã‚³ãƒ¼ãƒ‰é–¢é€£</h6>
                            <ul class="small">
                                <li><strong>æ§‹æ–‡ã‚¨ãƒ©ãƒ¼</strong>: ã‚³ãƒ¼ãƒ‰ã®æ–‡æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
                                <li><strong>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</strong>: å‡¦ç†ãŒé‡ã™ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿é‡ã‚’æ¸›ã‚‰ã—ã¦ãã ã•ã„</li>
                                <li><strong>ãƒ¡ãƒ¢ãƒªä¸è¶³</strong>: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã¯åˆ†å‰²ã—ã¦ãã ã•ã„</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-3">
                        <h6>ğŸ“ ã‚µãƒãƒ¼ãƒˆ</h6>
                        <p class="small mb-0">ã‚¨ãƒ©ãƒ¼ãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
<script>
let codeEditor = null;
let generatedCode = '';

// è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆ
function generateConfigFields() {
    const configForm = document.getElementById('configForm');
    const toolId = {{ tool.id }};
    
    // ãƒ„ãƒ¼ãƒ«åˆ¥ã®è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    const configs = {
        1: [ // ãƒ¡ãƒ¼ãƒ«è‡ªå‹•é€ä¿¡
            { name: 'sender_email', label: 'é€ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type: 'email', placeholder: 'your_email@gmail.com' },
            { name: 'receiver_email', label: 'å—ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type: 'email', placeholder: 'receiver@example.com' },
            { name: 'subject', label: 'ä»¶å', type: 'text', placeholder: 'è‡ªå‹•é€ä¿¡ãƒ¡ãƒ¼ãƒ«' },
            { name: 'message', label: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', type: 'textarea', placeholder: 'ã“ã‚Œã¯è‡ªå‹•é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã§ã™ã€‚' }
        ],
        2: [ // Excelè‡ªå‹•å‡¦ç†
            { name: 'input_file', label: 'å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«å', type: 'text', placeholder: 'data.xlsx' },
            { name: 'output_file', label: 'å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å', type: 'text', placeholder: 'result.xlsx' },
            { name: 'target_column', label: 'é›†è¨ˆå¯¾è±¡åˆ—', type: 'text', placeholder: 'å£²ä¸Š' }
        ],
        6: [ // ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•æ•´ç†
            { name: 'folder_path', label: 'æ•´ç†å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€', type: 'text', placeholder: 'C:/Users/YourName/Downloads' }
        ]
    };
    
    const fields = configs[toolId] || [
        { name: 'custom_setting', label: 'ã‚«ã‚¹ã‚¿ãƒ è¨­å®š', type: 'text', placeholder: 'è¨­å®šå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' }
    ];
    
    configForm.innerHTML = fields.map(field => `
        <div class="mb-3">
            <label for="${field.name}" class="form-label">${field.label}</label>
            ${field.type === 'textarea' 
                ? `<textarea id="${field.name}" class="form-control" placeholder="${field.placeholder}"></textarea>`
                : `<input type="${field.type}" id="${field.name}" class="form-control" placeholder="${field.placeholder}">`
            }
        </div>
    `).join('');
}

// ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
document.getElementById('generateBtn').addEventListener('click', async function() {
    const btn = this;
    const prompt = document.getElementById('promptInput').value;
    
    if (!prompt.trim()) {
        alert('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
    }
    
    btn.disabled = true;
    btn.querySelector('.loading').style.display = 'inline-block';
    
    try {
        const response = await fetch('/api/generate-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tool_id: {{ tool.id }},
                custom_prompt: prompt
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            generatedCode = data.code;
            
            // CodeMirrorã‚¨ãƒ‡ã‚£ã‚¿ã‚’åˆæœŸåŒ–
            if (codeEditor) {
                codeEditor.setValue(generatedCode);
            } else {
                const textarea = document.createElement('textarea');
                textarea.id = 'codeEditor';
                document.getElementById('codeContainer').innerHTML = '';
                document.getElementById('codeContainer').appendChild(textarea);
                
                codeEditor = CodeMirror.fromTextArea(textarea, {
                    mode: 'python',
                    theme: 'monokai',
                    lineNumbers: true,
                    readOnly: false
                });
                codeEditor.setValue(generatedCode);
            }
            
            document.getElementById('executeBtn').disabled = false;
            document.getElementById('downloadBtn').disabled = false;
            
        } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
        }
        
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    } finally {
        btn.disabled = false;
        btn.querySelector('.loading').style.display = 'none';
    }
});

// ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
document.getElementById('executeBtn').addEventListener('click', async function() {
    const btn = this;
    const code = codeEditor ? codeEditor.getValue() : generatedCode;
    
    if (!code.trim()) {
        alert('å®Ÿè¡Œã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    btn.disabled = true;
    btn.querySelector('.loading').style.display = 'inline-block';
    
    try {
        const response = await fetch('/api/execute-code', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tool_id: {{ tool.id }},
                code: code
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            let resultHtml = '<div class="alert alert-success"><strong>âœ… å®Ÿè¡ŒæˆåŠŸï¼</strong></div>';
            
            if (data.stdout) {
                resultHtml += `<div class="result-box"><strong>å‡ºåŠ›:</strong><br>${data.stdout.replace(/\n/g, '<br>')}</div>`;
            }
            
            if (data.stderr) {
                resultHtml += `<div class="result-box text-danger"><strong>ã‚¨ãƒ©ãƒ¼:</strong><br>${data.stderr.replace(/\n/g, '<br>')}</div>`;
            }
            
            document.getElementById('resultContainer').innerHTML = resultHtml;
            
        } else {
            let errorMessage = data.error;
            let errorType = 'danger';
            let errorIcon = 'âŒ';
            
            if (data.error.includes('Security:')) {
                errorMessage = 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯Webå®Ÿè¡Œç’°å¢ƒã§ã¯å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚';
                errorType = 'warning';
                errorIcon = 'ğŸ”’';
            } else if (data.error.includes('timed out')) {
                errorMessage = 'ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡ŒãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚„é•·æ™‚é–“ã®å‡¦ç†ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
                errorType = 'warning';
                errorIcon = 'â°';
            } else if (data.error.includes('FileNotFoundError')) {
                errorMessage = 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚';
                errorType = 'info';
                errorIcon = 'ğŸ“';
            } else if (data.error.includes('ImportError')) {
                errorMessage = 'å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
                errorType = 'warning';
                errorIcon = 'ğŸ“¦';
            } else if (data.error.includes('PermissionError')) {
                errorMessage = 'æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
                errorType = 'danger';
                errorIcon = 'ğŸš«';
            }
            
            document.getElementById('resultContainer').innerHTML = 
                `<div class="alert alert-${errorType}">
                    <strong>${errorIcon} å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:</strong><br>
                    ${errorMessage}
                    <div class="mt-2">
                        <small class="text-muted">
                            ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã¯ã€Œã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•ã€ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                        </small>
                    </div>
                </div>`;
        }
        
    } catch (error) {
        document.getElementById('resultContainer').innerHTML = 
            `<div class="alert alert-danger"><strong>âŒ ã‚¨ãƒ©ãƒ¼:</strong><br>${error.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.querySelector('.loading').style.display = 'none';
    }
});

// ã‚³ãƒ¼ãƒ‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
document.getElementById('downloadBtn').addEventListener('click', function() {
    const code = codeEditor ? codeEditor.getValue() : generatedCode;
    
    if (!code.trim()) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    
    const blob = new Blob([code], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '{{ tool.title }}_code.py';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});

// è¨­å®šä¿å­˜
document.getElementById('saveConfigBtn').addEventListener('click', async function() {
    const configData = {};
    const configForm = document.getElementById('configForm');
    const inputs = configForm.querySelectorAll('input, textarea');
    
    inputs.forEach(input => {
        configData[input.id] = input.value;
    });
    
    try {
        const response = await fetch('/api/save-config', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tool_id: {{ tool.id }},
                config: configData
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
        }
        
    } catch (error) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
});

// ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
let uploadedFiles = [];

// ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');

uploadZone.addEventListener('dragover', function(e) {
    e.preventDefault();
    uploadZone.classList.add('dragover');
});

uploadZone.addEventListener('dragleave', function(e) {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
});

uploadZone.addEventListener('drop', function(e) {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    handleFiles(files);
});

fileInput.addEventListener('change', function(e) {
    handleFiles(e.target.files);
});

function handleFiles(files) {
    Array.from(files).forEach(file => {
        uploadFile(file);
    });
}

async function uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    try {
        const response = await fetch('/api/upload-file', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            uploadedFiles.push({
                id: data.file_id,
                filename: data.filename
            });
            updateUploadedFilesList();
            showAlert('success', data.message);
        } else {
            showAlert('danger', data.error);
        }
    } catch (error) {
        showAlert('danger', 'ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

function updateUploadedFilesList() {
    const container = document.getElementById('uploadedFiles');
    
    if (uploadedFiles.length === 0) {
        container.innerHTML = '<p class="text-muted">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        return;
    }
    
    container.innerHTML = uploadedFiles.map(file => `
        <div class="uploaded-file">
            <div class="file-info">
                <span class="file-icon">ğŸ“</span>
                <span>${file.filename}</span>
            </div>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('${file.id}')">
                ğŸ—‘ï¸ å‰Šé™¤
            </button>
        </div>
    `).join('');
}

async function deleteFile(fileId) {
    try {
        const response = await fetch(`/api/delete-file/${fileId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            uploadedFiles = uploadedFiles.filter(file => file.id !== fileId);
            updateUploadedFilesList();
            showAlert('success', data.message);
        } else {
            showAlert('danger', data.error);
        }
    } catch (error) {
        showAlert('danger', 'ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
    
    // 3ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆã™
    setTimeout(() => {
        alertDiv.remove();
    }, 3000);
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    generateConfigFields();
    updateUploadedFilesList();
});
</script>
</body>
</html> 