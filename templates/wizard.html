<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tool.title }} - è¨­å®šã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ - Pythonã§ã§ãã‚‹ãƒ“ã‚¸ãƒã‚¹è‡ªå‹•åŒ–</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .wizard-step { background: white; padding: 30px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .step-indicator { display: flex; justify-content: center; margin-bottom: 30px; }
        .step-dot { width: 40px; height: 40px; border-radius: 50%; background: #e9ecef; color: #6c757d; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold; }
        .step-dot.active { background: #007bff; color: white; }
        .step-dot.completed { background: #28a745; color: white; }
        .step-line { width: 60px; height: 3px; background: #e9ecef; margin: 18px 0; }
        .step-line.completed { background: #28a745; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <a href="/" class="btn btn-outline-secondary mb-4">â† ä¸€è¦§ã«æˆ»ã‚‹</a>
            <a href="{{ url_for('tool_detail', tool_id=tool.id) }}" class="btn btn-outline-primary mb-4">ğŸ“‹ è©³ç´°ã‚’è¦‹ã‚‹</a>
            
            <div class="mb-3 d-flex align-items-center">
                <span class="badge bg-secondary me-2">{{ tool.category }}</span>
                <span class="badge bg-primary">{{ tool.id }}</span>
            </div>
            <h1 class="mb-4">âš™ï¸ {{ tool.title }} - è¨­å®šã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰</h1>
            <p class="lead">{{ tool.desc }}</p>
        </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div class="step-indicator">
        <div class="step-dot active" id="step1-dot">1</div>
        <div class="step-line" id="step1-line"></div>
        <div class="step-dot" id="step2-dot">2</div>
        <div class="step-line" id="step2-line"></div>
        <div class="step-dot" id="step3-dot">3</div>
        <div class="step-line" id="step3-line"></div>
        <div class="step-dot" id="step4-dot">4</div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—1: åŸºæœ¬è¨­å®š -->
    <div class="wizard-step" id="step1">
        <h3>ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—1: åŸºæœ¬è¨­å®š</h3>
        <p class="text-muted">ã¾ãšã€ã“ã®è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã®åŸºæœ¬è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="project_name" class="form-label">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</label>
                    <input type="text" class="form-control" id="project_name" placeholder="ä¾‹: ãƒ¡ãƒ¼ãƒ«è‡ªå‹•é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ ">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="description" class="form-label">èª¬æ˜</label>
                    <textarea class="form-control" id="description" rows="3" placeholder="ã“ã®è‡ªå‹•åŒ–ã®ç›®çš„ã‚„å†…å®¹ã‚’èª¬æ˜ã—ã¦ãã ã•ã„"></textarea>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <button class="btn btn-primary" onclick="nextStep(1)">æ¬¡ã¸ â†’</button>
        </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—2: è©³ç´°è¨­å®š -->
    <div class="wizard-step" id="step2" style="display: none;">
        <h3>âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ—2: è©³ç´°è¨­å®š</h3>
        <p class="text-muted">ã“ã®è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã«å¿…è¦ãªè©³ç´°è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p>
        
        <div id="tool-specific-config">
            <!-- ãƒ„ãƒ¼ãƒ«åˆ¥ã®è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        </div>
        
        <div class="mt-4">
            <button class="btn btn-secondary" onclick="prevStep(2)">â† æˆ»ã‚‹</button>
            <button class="btn btn-primary" onclick="nextStep(2)">æ¬¡ã¸ â†’</button>
        </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ç¢ºèª -->
    <div class="wizard-step" id="step3" style="display: none;">
        <h3>âœ… ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šç¢ºèª</h3>
        <p class="text-muted">å…¥åŠ›ã—ãŸè¨­å®šå†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
        
        <div id="config-summary">
            <!-- è¨­å®šå†…å®¹ã®ã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>
        
        <div class="mt-4">
            <button class="btn btn-secondary" onclick="prevStep(3)">â† æˆ»ã‚‹</button>
            <button class="btn btn-success" onclick="nextStep(3)">è¨­å®šã‚’ä¿å­˜ â†’</button>
        </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—4: å®Œäº† -->
    <div class="wizard-step" id="step4" style="display: none;">
        <h3>ğŸ‰ ã‚¹ãƒ†ãƒƒãƒ—4: è¨­å®šå®Œäº†</h3>
        <div class="text-center">
            <div class="mb-4">
                <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
            </div>
            <h4>è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸï¼</h4>
            <p class="text-muted">ã“ã‚Œã§è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚</p>
            
            <div class="mt-4">
                <a href="{{ url_for('execute_tool', tool_id=tool.id) }}" class="btn btn-success btn-lg">
                    ğŸ¤– ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å®Ÿè¡Œã—ã¦ã¿ã‚‹
                </a>
            </div>
            
            <div class="mt-3">
                <a href="{{ url_for('tool_detail', tool_id=tool.id) }}" class="btn btn-outline-primary">
                    ğŸ“‹ è©³ç´°ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
                </a>
            </div>
        </div>
    </div>
</div>

<script>
let currentStep = 1;
let configData = {};

// ãƒ„ãƒ¼ãƒ«åˆ¥ã®è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç”Ÿæˆ
function generateToolConfig() {
    const toolId = {{ tool.id }};
    const configContainer = document.getElementById('tool-specific-config');
    
    const configs = {
        1: [ // ãƒ¡ãƒ¼ãƒ«è‡ªå‹•é€ä¿¡
            { name: 'sender_email', label: 'é€ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type: 'email', required: true, placeholder: 'your_email@gmail.com' },
            { name: 'sender_password', label: 'ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', type: 'password', required: true, placeholder: 'Gmailã®ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰' },
            { name: 'receiver_email', label: 'å—ä¿¡è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type: 'email', required: true, placeholder: 'receiver@example.com' },
            { name: 'subject', label: 'ä»¶å', type: 'text', required: false, placeholder: 'è‡ªå‹•é€ä¿¡ãƒ¡ãƒ¼ãƒ«' },
            { name: 'message', label: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', type: 'textarea', required: false, placeholder: 'ã“ã‚Œã¯è‡ªå‹•é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã§ã™ã€‚' }
        ],
        2: [ // Excelè‡ªå‹•å‡¦ç†
            { name: 'input_file', label: 'å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«å', type: 'text', required: true, placeholder: 'data.xlsx' },
            { name: 'output_file', label: 'å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å', type: 'text', required: true, placeholder: 'result.xlsx' },
            { name: 'target_column', label: 'é›†è¨ˆå¯¾è±¡åˆ—', type: 'text', required: true, placeholder: 'å£²ä¸Š' },
            { name: 'sheet_name', label: 'ã‚·ãƒ¼ãƒˆå', type: 'text', required: false, placeholder: 'Sheet1' }
        ],
        6: [ // ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•æ•´ç†
            { name: 'folder_path', label: 'æ•´ç†å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€', type: 'text', required: true, placeholder: 'C:/Users/YourName/Downloads' },
            { name: 'create_backup', label: 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ', type: 'checkbox', required: false },
            { name: 'delete_original', label: 'å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤', type: 'checkbox', required: false }
        ]
    };
    
    const fields = configs[toolId] || [
        { name: 'custom_setting', label: 'ã‚«ã‚¹ã‚¿ãƒ è¨­å®š', type: 'text', required: true, placeholder: 'è¨­å®šå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' }
    ];
    
    configContainer.innerHTML = fields.map(field => `
        <div class="mb-3">
            <label for="${field.name}" class="form-label">
                ${field.label}
                ${field.required ? '<span class="text-danger">*</span>' : ''}
            </label>
            ${field.type === 'textarea' 
                ? `<textarea class="form-control" id="${field.name}" placeholder="${field.placeholder}" ${field.required ? 'required' : ''}></textarea>`
                : field.type === 'checkbox'
                ? `<div class="form-check"><input class="form-check-input" type="checkbox" id="${field.name}"><label class="form-check-label" for="${field.name}">${field.label}</label></div>`
                : `<input type="${field.type}" class="form-control" id="${field.name}" placeholder="${field.placeholder}" ${field.required ? 'required' : ''}>`
            }
        </div>
    `).join('');
}

// è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’åé›†
function collectConfigData() {
    configData = {
        project_name: document.getElementById('project_name').value,
        description: document.getElementById('description').value,
        tool_id: {{ tool.id }},
        tool_title: '{{ tool.title }}',
        settings: {}
    };
    
    // ãƒ„ãƒ¼ãƒ«å›ºæœ‰ã®è¨­å®šã‚’åé›†
    const configContainer = document.getElementById('tool-specific-config');
    const inputs = configContainer.querySelectorAll('input, textarea');
    
    inputs.forEach(input => {
        if (input.type === 'checkbox') {
            configData.settings[input.id] = input.checked;
        } else {
            configData.settings[input.id] = input.value;
        }
    });
}

// è¨­å®šã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
function showConfigSummary() {
    const summaryContainer = document.getElementById('config-summary');
    
    let summaryHtml = `
        <div class="card">
            <div class="card-body">
                <h5>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±</h5>
                <p><strong>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:</strong> ${configData.project_name}</p>
                <p><strong>èª¬æ˜:</strong> ${configData.description}</p>
                <p><strong>ãƒ„ãƒ¼ãƒ«:</strong> ${configData.tool_title}</p>
                
                <h5 class="mt-3">è¨­å®šå†…å®¹</h5>
    `;
    
    Object.entries(configData.settings).forEach(([key, value]) => {
        summaryHtml += `<p><strong>${key}:</strong> ${value}</p>`;
    });
    
    summaryHtml += '</div></div>';
    summaryContainer.innerHTML = summaryHtml;
}

// æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€
function nextStep(step) {
    if (step === 1) {
        // åŸºæœ¬è¨­å®šã®æ¤œè¨¼
        const projectName = document.getElementById('project_name').value;
        if (!projectName.trim()) {
            alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        // ã‚¹ãƒ†ãƒƒãƒ—2ã‚’è¡¨ç¤º
        document.getElementById('step1').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        document.getElementById('step1-dot').classList.remove('active');
        document.getElementById('step1-dot').classList.add('completed');
        document.getElementById('step1-line').classList.add('completed');
        document.getElementById('step2-dot').classList.add('active');
        currentStep = 2;
        
    } else if (step === 2) {
        // è©³ç´°è¨­å®šã®æ¤œè¨¼
        const requiredFields = document.querySelectorAll('#tool-specific-config [required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add('is-invalid');
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (!isValid) {
            alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        // è¨­å®šãƒ‡ãƒ¼ã‚¿ã‚’åé›†
        collectConfigData();
        showConfigSummary();
        
        // ã‚¹ãƒ†ãƒƒãƒ—3ã‚’è¡¨ç¤º
        document.getElementById('step2').style.display = 'none';
        document.getElementById('step3').style.display = 'block';
        document.getElementById('step2-dot').classList.remove('active');
        document.getElementById('step2-dot').classList.add('completed');
        document.getElementById('step2-line').classList.add('completed');
        document.getElementById('step3-dot').classList.add('active');
        currentStep = 3;
        
    } else if (step === 3) {
        // è¨­å®šã‚’ä¿å­˜
        saveConfig();
        
        // ã‚¹ãƒ†ãƒƒãƒ—4ã‚’è¡¨ç¤º
        document.getElementById('step3').style.display = 'none';
        document.getElementById('step4').style.display = 'block';
        document.getElementById('step3-dot').classList.remove('active');
        document.getElementById('step3-dot').classList.add('completed');
        document.getElementById('step3-line').classList.add('completed');
        document.getElementById('step4-dot').classList.add('active');
        currentStep = 4;
    }
}

// å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã«æˆ»ã‚‹
function prevStep(step) {
    if (step === 2) {
        document.getElementById('step2').style.display = 'none';
        document.getElementById('step1').style.display = 'block';
        document.getElementById('step2-dot').classList.remove('active');
        document.getElementById('step1-dot').classList.remove('completed');
        document.getElementById('step1-dot').classList.add('active');
        document.getElementById('step1-line').classList.remove('completed');
        currentStep = 1;
    } else if (step === 3) {
        document.getElementById('step3').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        document.getElementById('step3-dot').classList.remove('active');
        document.getElementById('step2-dot').classList.remove('completed');
        document.getElementById('step2-dot').classList.add('active');
        document.getElementById('step2-line').classList.remove('completed');
        currentStep = 2;
    }
}

// è¨­å®šã‚’ä¿å­˜
async function saveConfig() {
    try {
        const response = await fetch('/api/save-config', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(configData)
        });
        
        const data = await response.json();
        
        if (!data.success) {
            alert('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.error);
        }
        
    } catch (error) {
        console.error('è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
    }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    generateToolConfig();
});
</script>
</body>
</html> 