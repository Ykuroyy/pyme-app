<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ã‚¹ãƒãƒ›ã§ç°¡å˜ï¼ä»•äº‹ã®é›‘å‹™ã‚’è‡ªå‹•åŒ–">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="é›‘å‹™è‡ªå‹•åŒ–">
    
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/svg+xml" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/icons/robot.svg">
    
    <title>ğŸ“± é›‘å‹™è‡ªå‹•åŒ–ã‚¢ãƒ—ãƒª - ã‚¹ãƒãƒ›ã§ç°¡å˜ï¼</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --dark-color: #343a40;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            padding-bottom: 100px;
        }
        
        .main-container {
            max-width: 100%;
            padding: 15px;
        }
        
        /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚«ãƒ¼ãƒ‰ */
        .profile-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* è‡ªå‹•åŒ–ãƒœã‚¿ãƒ³ */
        .automation-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0;
            width: 100%;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .automation-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .automation-btn.email {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .automation-btn.excel {
            background: linear-gradient(135deg, #2ed573 0%, #1e90ff 100%);
        }
        
        .automation-btn.file {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        }
        
        .automation-btn.report {
            background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
        }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        .form-control, .form-select {
            border-radius: 15px;
            border: 2px solid #e9ecef;
            padding: 15px;
            font-size: 1rem;
            min-height: 55px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            transform: scale(1.02);
        }
        
        /* ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šãƒœã‚¿ãƒ³ */
        .quick-setup {
            background: rgba(255, 255, 255, 0.2);
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-setup:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
        }
        
        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .setup-progress {
            background: rgba(255, 255, 255, 0.3);
            height: 8px;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .setup-progress-bar {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        /* å®Ÿè¡ŒçŠ¶æ…‹ */
        .execution-status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 9999;
            display: none;
            min-width: 300px;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ã‚¿ãƒ– */
        .nav-tabs {
            border: none;
            margin-bottom: 20px;
        }
        
        .nav-tabs .nav-link {
            border-radius: 15px;
            margin-right: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
        }
        
        .nav-tabs .nav-link.active {
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark-color);
        }
        
        /* ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ */
        .shortcuts {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        
        .shortcut-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .shortcut-btn:hover {
            transform: scale(1.1);
            color: white;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width: 576px) {
            .main-container {
                padding: 10px;
            }
            
            .automation-btn {
                font-size: 1rem;
                padding: 15px;
                min-height: 70px;
            }
            
            .profile-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="text-center text-white mb-4">
            <h1 class="mb-2">ğŸš€ é›‘å‹™è‡ªå‹•åŒ–</h1>
            <p class="lead">ã‚¹ãƒãƒ›ã§ç°¡å˜ï¼ãƒœã‚¿ãƒ³1ã¤ã§ä»•äº‹å®Œäº†</p>
        </div>

        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ -->
        <div class="setup-progress">
            <div class="setup-progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="setup-tab" data-bs-toggle="tab" data-bs-target="#setup" type="button">
                    âš™ï¸ åˆæœŸè¨­å®š
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="automation-tab" data-bs-toggle="tab" data-bs-target="#automation" type="button">
                    ğŸš€ è‡ªå‹•åŒ–å®Ÿè¡Œ
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <!-- åˆæœŸè¨­å®šã‚¿ãƒ– -->
            <div class="tab-pane fade show active" id="setup" role="tabpanel">
                <div class="profile-card">
                    <h3 class="mb-3">ğŸ‘¤ ã‚ãªãŸã®æƒ…å ±</h3>
                    <p class="text-muted small">ä¸€åº¦å…¥åŠ›ã™ã‚Œã°ã€ã™ã¹ã¦ã®è‡ªå‹•åŒ–ã§ä½¿ã„å›ã›ã¾ã™</p>
                    
                    <form id="profileForm">
                        <div class="mb-3">
                            <label class="form-label">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" class="form-control" id="userEmail" placeholder="ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«@gmail.com" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ğŸ‘¤ ãŠåå‰</label>
                            <input type="text" class="form-control" id="userName" placeholder="å±±ç”°å¤ªéƒ" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ğŸ¢ ä¼šç¤¾å</label>
                            <input type="text" class="form-control" id="userCompany" placeholder="æ ªå¼ä¼šç¤¾â—‹â—‹">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ğŸ“± é›»è©±ç•ªå·</label>
                            <input type="tel" class="form-control" id="userPhone" placeholder="090-1234-5678">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ğŸ“ ã‚ˆãä½¿ã†ãƒ•ã‚©ãƒ«ãƒ€</label>
                            <input type="text" class="form-control" id="userFolder" placeholder="C:\Users\ã‚ãªãŸã®åå‰\Desktop" value="C:\Users\YourName\Desktop">
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100" style="min-height: 55px; border-radius: 15px; font-size: 1.1rem;">
                            ğŸ’¾ æƒ…å ±ã‚’ä¿å­˜ã—ã¦æ¬¡ã¸
                        </button>
                    </form>
                </div>

                <!-- ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š -->
                <div class="quick-setup" onclick="loadSampleData()">
                    <h5>âš¡ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š</h5>
                    <p class="mb-0">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ä»Šã™ãè©¦ã™</p>
                </div>
            </div>

            <!-- è‡ªå‹•åŒ–å®Ÿè¡Œã‚¿ãƒ– -->
            <div class="tab-pane fade" id="automation" role="tabpanel">
                <!-- ã‚ˆãä½¿ã†è‡ªå‹•åŒ– -->
                <div class="profile-card">
                    <h3 class="mb-3">â­ ã‚ˆãä½¿ã†è‡ªå‹•åŒ–</h3>
                    
                    <button class="automation-btn email" onclick="runAutomation('email')">
                        <div>
                            <div style="font-size: 1.3rem;">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ä¸€æ‹¬é€ä¿¡</div>
                            <small>é¡§å®¢ãƒªã‚¹ãƒˆã«å–¶æ¥­ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡</small>
                        </div>
                        <div style="font-size: 2rem;">â–¶ï¸</div>
                    </button>
                    
                    <button class="automation-btn excel" onclick="runAutomation('excel')">
                        <div>
                            <div style="font-size: 1.3rem;">ğŸ“Š å£²ä¸Šãƒ‡ãƒ¼ã‚¿é›†è¨ˆ</div>
                            <small>Excelãƒ•ã‚¡ã‚¤ãƒ«ã®å£²ä¸Šã‚’è‡ªå‹•é›†è¨ˆ</small>
                        </div>
                        <div style="font-size: 2rem;">â–¶ï¸</div>
                    </button>
                    
                    <button class="automation-btn file" onclick="runAutomation('file')">
                        <div>
                            <div style="font-size: 1.3rem;">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†</div>
                            <small>æ•£ã‚‰ã‹ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•æ•´ç†</small>
                        </div>
                        <div style="font-size: 2rem;">â–¶ï¸</div>
                    </button>
                    
                    <button class="automation-btn report" onclick="runAutomation('report')">
                        <div>
                            <div style="font-size: 1.3rem;">ğŸ“„ æ—¥å ±ä½œæˆ</div>
                            <small>ä»Šæ—¥ã®ä½œæ¥­ã‚’è‡ªå‹•ã§ãƒ¬ãƒãƒ¼ãƒˆåŒ–</small>
                        </div>
                        <div style="font-size: 2rem;">â–¶ï¸</div>
                    </button>
                </div>

                <!-- ã‚«ã‚¹ã‚¿ãƒ è‡ªå‹•åŒ– -->
                <div class="profile-card">
                    <h3 class="mb-3">ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒ è‡ªå‹•åŒ–</h3>
                    <p class="text-muted">éŸ³å£°ã§æŒ‡ç¤ºã™ã‚‹ã¨ã€AIãŒè‡ªå‹•åŒ–ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™</p>
                    
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="customRequest" placeholder="ä¾‹ï¼šæ¯é€±é‡‘æ›œæ—¥ã«é€±å ±ã‚’ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã—ãŸã„">
                        <button class="btn btn-success" type="button" onclick="createCustomAutomation()">
                            ğŸ¤ éŸ³å£°å…¥åŠ›
                        </button>
                    </div>
                    
                    <button class="btn btn-outline-light w-100" onclick="createCustomAutomation()">
                        âœ¨ ã‚«ã‚¹ã‚¿ãƒ è‡ªå‹•åŒ–ã‚’ä½œæˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- å®Ÿè¡ŒçŠ¶æ…‹ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="execution-status" id="executionStatus">
        <div class="spinner"></div>
        <h4 id="statusTitle">è‡ªå‹•åŒ–å®Ÿè¡Œä¸­...</h4>
        <p id="statusMessage">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
        <button class="btn btn-outline-light" onclick="hideExecutionStatus()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>

    <!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
    <div class="shortcuts">
        <button class="shortcut-btn" onclick="quickEmail()" title="ã‚¯ã‚¤ãƒƒã‚¯ãƒ¡ãƒ¼ãƒ«">
            ğŸ“§
        </button>
        <button class="shortcut-btn" onclick="quickExcel()" title="ã‚¯ã‚¤ãƒƒã‚¯é›†è¨ˆ">
            ğŸ“Š
        </button>
        <button class="shortcut-btn" onclick="voiceCommand()" title="éŸ³å£°ã‚³ãƒãƒ³ãƒ‰">
            ğŸ¤
        </button>
    </div>

    <!-- PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒãƒŠãƒ¼ -->
    <div id="installBanner" class="position-fixed bottom-0 start-0 end-0 bg-success text-white p-3" style="display: none; z-index: 9998; margin-bottom: 80px;">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</strong>
                    <br>
                    <small>ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã€ã„ã¤ã§ã‚‚é›‘å‹™è‡ªå‹•åŒ–</small>
                </div>
                <div>
                    <button id="installBtn" class="btn btn-light btn-sm me-2">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
                    <button id="dismissBtn" class="btn btn-outline-light btn-sm">Ã—</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
        let userProfile = {};
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            initializePWA();
            checkSetupCompletion();
        });

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
        function loadUserProfile() {
            const saved = localStorage.getItem('userProfile');
            if (saved) {
                userProfile = JSON.parse(saved);
                
                // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
                document.getElementById('userEmail').value = userProfile.email || '';
                document.getElementById('userName').value = userProfile.name || '';
                document.getElementById('userCompany').value = userProfile.company || '';
                document.getElementById('userPhone').value = userProfile.phone || '';
                document.getElementById('userFolder').value = userProfile.folder || 'C:\\Users\\YourName\\Desktop';
                
                updateProgress();
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            userProfile = {
                email: document.getElementById('userEmail').value,
                name: document.getElementById('userName').value,
                company: document.getElementById('userCompany').value,
                phone: document.getElementById('userPhone').value,
                folder: document.getElementById('userFolder').value,
                setupDate: new Date().toISOString()
            };
            
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            
            showSuccessMessage('âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            updateProgress();
            
            // è‡ªå‹•åŒ–ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
            setTimeout(() => {
                document.getElementById('automation-tab').click();
            }, 1000);
        });

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadSampleData() {
            document.getElementById('userEmail').value = 'yamada.taro@company.com';
            document.getElementById('userName').value = 'å±±ç”°å¤ªéƒ';
            document.getElementById('userCompany').value = 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«';
            document.getElementById('userPhone').value = '090-1234-5678';
            document.getElementById('userFolder').value = 'C:\\Users\\yamada\\Desktop';
            
            showSuccessMessage('âš¡ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
        function updateProgress() {
            const fields = ['email', 'name', 'company', 'phone', 'folder'];
            const completed = fields.filter(field => userProfile[field] && userProfile[field].trim()).length;
            const progress = (completed / fields.length) * 100;
            
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ãƒã‚§ãƒƒã‚¯
        function checkSetupCompletion() {
            if (userProfile.email && userProfile.name) {
                document.getElementById('automation-tab').disabled = false;
            }
        }

        // è‡ªå‹•åŒ–å®Ÿè¡Œ
        async function runAutomation(type) {
            if (!userProfile.email) {
                showErrorMessage('âŒ å…ˆã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šã‚’å®Œäº†ã—ã¦ãã ã•ã„');
                document.getElementById('setup-tab').click();
                return;
            }

            showExecutionStatus(`${getAutomationName(type)}ã‚’å®Ÿè¡Œä¸­...`, 'æ•°ç§’ãŠå¾…ã¡ãã ã•ã„');

            try {
                const response = await fetch('/api/run-automation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: type,
                        userProfile: userProfile
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessStatus(`âœ… ${getAutomationName(type)}ãŒå®Œäº†ã—ã¾ã—ãŸï¼`, result.message);
                } else {
                    showErrorStatus(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`, result.error);
                }
            } catch (error) {
                showErrorStatus('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼', 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
            }
        }

        // è‡ªå‹•åŒ–åå–å¾—
        function getAutomationName(type) {
            const names = {
                'email': 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡',
                'excel': 'Excelé›†è¨ˆ',
                'file': 'ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†',
                'report': 'æ—¥å ±ä½œæˆ'
            };
            return names[type] || 'è‡ªå‹•åŒ–';
        }

        // ã‚¯ã‚¤ãƒƒã‚¯æ©Ÿèƒ½
        async function quickEmail() {
            if (!userProfile.email) {
                showErrorMessage('âŒ å…ˆã«ãƒ¡ãƒ¼ãƒ«è¨­å®šã‚’ã—ã¦ãã ã•ã„');
                return;
            }
            
            const recipient = prompt('ğŸ“§ é€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:', '');
            if (recipient) {
                showExecutionStatus('ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­...', `${recipient} ã«é€ä¿¡ã—ã¦ã„ã¾ã™`);
                // å®Ÿéš›ã®é€ä¿¡å‡¦ç†ã‚’ã“ã“ã«è¿½åŠ 
                setTimeout(() => {
                    showSuccessStatus('âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ï¼', `${recipient} ã«é€ä¿¡ã—ã¾ã—ãŸ`);
                }, 2000);
            }
        }

        async function quickExcel() {
            showExecutionStatus('ğŸ“Š ãƒ‡ãƒ¼ã‚¿é›†è¨ˆä¸­...', 'Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã—ã¦ã„ã¾ã™');
            // å®Ÿéš›ã®é›†è¨ˆå‡¦ç†ã‚’ã“ã“ã«è¿½åŠ 
            setTimeout(() => {
                showSuccessStatus('âœ… é›†è¨ˆå®Œäº†ï¼', 'çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸ');
            }, 3000);
        }

        // éŸ³å£°ã‚³ãƒãƒ³ãƒ‰
        function voiceCommand() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showErrorMessage('âŒ ã“ã®ç«¯æœ«ã§ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
                return;
            }

            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'ja-JP';
            recognition.continuous = false;
            recognition.interimResults = false;

            showExecutionStatus('ğŸ¤ éŸ³å£°ã‚’èã„ã¦ã„ã¾ã™...', 'è‡ªå‹•åŒ–ã—ãŸã„å†…å®¹ã‚’è©±ã—ã¦ãã ã•ã„');

            recognition.onresult = function(event) {
                const command = event.results[0][0].transcript;
                document.getElementById('customRequest').value = command;
                hideExecutionStatus();
                showSuccessMessage(`ğŸ¤ ã€Œ${command}ã€ã‚’èªè­˜ã—ã¾ã—ãŸ`);
            };

            recognition.onerror = function() {
                hideExecutionStatus();
                showErrorMessage('âŒ éŸ³å£°èªè­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            };

            recognition.start();
        }

        // ã‚«ã‚¹ã‚¿ãƒ è‡ªå‹•åŒ–ä½œæˆ
        async function createCustomAutomation() {
            const request = document.getElementById('customRequest').value;
            if (!request.trim()) {
                showErrorMessage('âŒ è‡ªå‹•åŒ–ã—ãŸã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showExecutionStatus('ğŸ¤– AIãŒã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆä¸­...', 'ã‚ãªãŸå°‚ç”¨ã®è‡ªå‹•åŒ–ã‚’æº–å‚™ã—ã¦ã„ã¾ã™');

            try {
                const response = await fetch('/api/create-custom-automation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        request: request,
                        userProfile: userProfile
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccessStatus('âœ… ã‚«ã‚¹ã‚¿ãƒ è‡ªå‹•åŒ–ã‚’ä½œæˆã—ã¾ã—ãŸï¼', 'ã™ãã«å®Ÿè¡Œã§ãã¾ã™');
                    // ä½œæˆã—ãŸè‡ªå‹•åŒ–ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
                    addCustomAutomationButton(result.automation);
                } else {
                    showErrorStatus('âŒ ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', result.error);
                }
            } catch (error) {
                showErrorStatus('âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼', 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
            }
        }

        // ã‚«ã‚¹ã‚¿ãƒ è‡ªå‹•åŒ–ãƒœã‚¿ãƒ³è¿½åŠ 
        function addCustomAutomationButton(automation) {
            const container = document.querySelector('#automation .profile-card');
            const button = document.createElement('button');
            button.className = 'automation-btn';
            button.style.background = 'linear-gradient(135deg, #17a2b8 0%, #138496 100%)';
            button.onclick = () => runCustomAutomation(automation.id);
            button.innerHTML = `
                <div>
                    <div style="font-size: 1.3rem;">âš™ï¸ ${automation.name}</div>
                    <small>${automation.description}</small>
                </div>
                <div style="font-size: 2rem;">â–¶ï¸</div>
            `;
            container.appendChild(button);
        }

        // å®Ÿè¡ŒçŠ¶æ…‹è¡¨ç¤º
        function showExecutionStatus(title, message) {
            document.getElementById('statusTitle').textContent = title;
            document.getElementById('statusMessage').textContent = message;
            document.getElementById('executionStatus').style.display = 'block';
        }

        function showSuccessStatus(title, message) {
            document.getElementById('statusTitle').textContent = title;
            document.getElementById('statusMessage').textContent = message;
            document.querySelector('.spinner').style.display = 'none';
            setTimeout(hideExecutionStatus, 3000);
        }

        function showErrorStatus(title, message) {
            document.getElementById('statusTitle').textContent = title;
            document.getElementById('statusMessage').textContent = message;
            document.querySelector('.spinner').style.display = 'none';
            setTimeout(hideExecutionStatus, 3000);
        }

        function hideExecutionStatus() {
            document.getElementById('executionStatus').style.display = 'none';
            document.querySelector('.spinner').style.display = 'block';
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showSuccessMessage(message) {
            showToast(message, 'success');
        }

        function showErrorMessage(message) {
            showToast(message, 'danger');
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // PWAæ©Ÿèƒ½
        function initializePWA() {
            // Service Workerç™»éŒ²
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/static/sw.js');
            }

            // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installBanner').style.display = 'block';
            });

            document.getElementById('installBtn').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => {
                        deferredPrompt = null;
                        document.getElementById('installBanner').style.display = 'none';
                    });
                }
            });

            document.getElementById('dismissBtn').addEventListener('click', () => {
                document.getElementById('installBanner').style.display = 'none';
            });
        }
    </script>
</body>
</html>